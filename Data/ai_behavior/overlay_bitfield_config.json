{
    "_doc": [
        "Overlay bitfield patches - controls which offensive spells monsters HAVE.",
        "Applied to output/BLAZE.ALL overlay code before BIN injection.",
        "",
        "Two modes:",
        "  zone_wide:   All monsters get the same bitfield (original approach).",
        "  per_monster:  Each monster type gets its own bitfield via table lookup.",
        "",
        "For per_monster mode:",
        "  monsters: { name: hex_bitfield } for each monster type in the zone.",
        "  default_bitfield: used for unknown identity values (safety fallback).",
        "  identity_offset: byte offset in entity struct for monster type ID.",
        "  identity_map: { name: integer } maps monster name to identity value.",
        "  min_identity: lowest identity value (for compact 3-entry table indexing).",
        "",
        "This is the DEFINITIVE value. The sentinel trick skips the level-up simulation.",
        "",
        "Bitfield quick reference (see Data/spells/MONSTER_SPELLS.md for full table):",
        "  0x00000001 = FireBullet only (vanilla)",
        "  0x0000001F = Tier 1: FireBullet, SparkBullet, WaterBullet, StoneBullet, Striking",
        "  0x000003FF = Tier 1+2: +Lightbolt, DarkWave, Smash, MagicMissile, EnchantWeapon",
        "  0x00007FFF = Tier 1-3: +Blaze, Lightningbolt, Blizzard, PoisonCloud, ExtendSpell",
        "  0x000FFFFF = Tier 1-4: +MagicRay, Shining, DarkBreath, DispellMagic, Petrifaction",
        "  0x03FFFFFF = Tier 1-5: +Explosion, Thunderbolt, FreezeBeast, EarthJavelin, DeathSpell, Teleport",
        "  0x1FFFFFFF = ALL 29 offensive spells"
    ],
    "overlay_bitfield_patches": {
        "enabled": false,
        "_PERMANENT_DISABLE": "All 6 attempts failed (v1-v6). Freeze tests confirmed offsets are DEAD CODE. See Data/ai_behavior/FAILED_ATTEMPTS.md",
        "patches": [
            {
                "zone": "Cavern of Death",
                "enabled": false,
                "mode": "per_monster",
                "enabled_NOTE": "FAILED â€” 6 attempts, all offsets dead/unused. Freeze test v6 (2026-02-11): NO CRASH = code never executes",
                "monsters": {
                    "Lv20.Goblin": "0x03FFFFFF",
                    "Goblin-Shaman": "0x03FFFFFF",
                    "Giant-Bat": "0x03FFFFFF"
                },
                "default_bitfield": "0x03FFFFFF",
                "_monsters_doc": {
                    "Lv20.Goblin": "DIAGNOSTIC: all tier 1-5 spells",
                    "Goblin-Shaman": "DIAGNOSTIC: all tier 1-5 spells",
                    "Giant-Bat": "DIAGNOSTIC: all tier 1-5 spells"
                },
                "_internal_do_not_modify": {
                    "type": "per_monster",
                    "code_start": "0x0098A69C",
                    "identity_offset": "0x10",
                    "identity_map": {
                        "Lv20.Goblin": 2,
                        "Goblin-Shaman": 3,
                        "Giant-Bat": 4
                    },
                    "min_identity": 2,
                    "combat_init_sites": [
                        {
                            "code_start": "0x0092BF74",
                            "_note": "Combat init: resets entity+0x160 at battle start. 13 slots (ori + 12 sb for slots 0-2). Entity base = $s5."
                        }
                    ],
                    "_identity_offset_note": "Entity struct offset for stat_b (monster type ID). If monsters behave wrong, try 0x12 instead."
                }
            }
        ]
    }
}
